# 抽獎機制詳解 (Mechanism & Fairness)

為了確保抽獎活動的公正性與趣味性，本系統設計了多樣化的抽獎模式。
本文件詳細說明各模式背後的程式邏輯與隨機算法。

## 🛡️ 核心亂數機制 (Core Randomness)

所有抽獎模式底層皆採用 JavaScript 標準的 `Math.random()` 函式生成亂數。
- `Math.random()` 使用 xorshift128+ 偽隨機演算法
- 每次抽獎皆為獨立事件，所有「未中獎且未被取消資格」的參與者，中獎機率皆相等。

## 🎰 各模式邏輯說明

### 1. 拉霸機 (Slot Machine)
*   **視覺**: 模擬傳統拉霸機，名字上下快速滾動。
*   **邏輯**:
    *   按下開始時，系統會先隨機挑選出最終得獎者。
    *   動畫階段：前端持續隨機顯示名單中的名字，製造滾動效果。
    *   減速階段：滾動速度變慢，最後精準停在後端回傳的「得獎者」名字上。

### 2. 多人批量拉霸 (Multiplayer Slot / Batch Draw)
*   **視覺**: 畫面上有九宮格或列表，一次顯示多個名字。
*   **邏輯**:
    *   適用於普獎（如一次抽 10 人）。
    *   程式會從符合資格的名單中，一次性隨機取出 N 個不重複的人員 ID。
    *   動畫僅為視覺效果，最終同時揭曉這 N 位得獎者。

### 3. 幸運轉盤 (Roulette)
*   **視覺**: 大圓盤切片，指針旋轉。
*   **邏輯**:
    *   轉盤上的切片根據「符合資格人數」動態生成。
    *   雖然視覺上有物理運算（減速曲線），但最終停止的角度是根據「得獎者」所在的切片反推計算出來的。
    *   系統先決定誰中獎，再計算轉盤需要轉多少圈、停在哪裡，確保指針一定會指到得獎者。

### 4. 員編抽獎 (Employee ID Draw)
*   **視覺**: 類似電表或密碼鎖，五位數 (如 T1234) 逐字揭曉。
*   **邏輯**:
    *   先決定中獎者。
    *   所有數字會先隨機跳動（從該位置曾出現過的字元中隨機選），增加懸念。
    *   依序鎖定：第一碼停下 -> 第二碼停下... -> 直到顯示完整中獎員編。
*   **更新**: 為了避免視覺上的誤會，滾動池中的字元是根據「所有候選人的員編」動態計算的，確保不會滾出一個「根本不存在的字元」。

### 5. 部門抽獎 (Department Draw)
*   **視覺**: 兩階段式。第一階段先抽「部門」，第二階段從該部門名單中抽出「人」。
*   **加權邏輯 (重要)**:
    *   為了避免「大部門人多，卻很難被抽到部門」或「小部門人少，一但抽到部門就幾乎人人中獎」的偏差感。
    *   **第一階段 (抽部門)** 採用 **加權隨機 (Weighted Random)**。
    *   權重 = 該部門符合資格的人數。
    *   **數學證明**:
        *   假設 A 部門有 100 人，B 部門有 10 人。總人數 110 人。
        *   A 部門被抽中的機率 = 100/110。
        *   若 A 部門被抽中，小明 (A部門) 中獎機率 = 1/100。
        *   **小明最終中獎率** = (100/110) * (1/100) = **1/110**。
        *   同理，小華 (B部門) 中獎率 = (10/110) * (1/10) = **1/110**。
    *   **結論**: 無論部門大小，**每個人的中獎機率都是完全一樣的 (1 / 總人數)**。

## 📊 數據處理與防呆

*   **排除機制**: 中獎者會被標記為 `isWinner: true`，自動排除在下一次抽獎名單外。
*   **資料持久化**: 狀態儲存於瀏覽器 LocalStorage，重新整理頁面不會丟失中獎紀錄。
*   **防重複**: 匯入名單時會檢查員編 (ID) 唯一性，避免同一人重複列入。

---
*本文件由開發團隊維護，旨在提供抽獎機制的詳細說明。*
